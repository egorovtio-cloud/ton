from hikkatl.types import Message
from .. import loader, utils
import aiohttp
import json

@loader.tds
class TonPriceMod(loader.Module):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –∫—É—Ä—Å TON –∫ —Ä—É–±–ª—é"""
    strings = {"name": "TonPrice"}

    async def toncmd(self, message: Message):
        """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–π –∫—É—Ä—Å TON/RUB"""
        try:
            async with aiohttp.ClientSession() as session:
                async with session.get("https://api2.binance.com/api/v3/ticker/price?symbol=TONRUB") as response:
                    if response.status == 200:
                        data = await response.json()
                        price = float(data["price"])
                        await utils.answer(
                            message,
                            f"<b>üí∞ –ö—É—Ä—Å TON/RUB:</b> <code>{price:.2f}</code>"
                        )
                    else:
                        await utils.answer(
                            message,
                            "<b>‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫—É—Ä—Å–∞</b>"
                        )
        except Exception as e:
            await utils.answer(
                message,
                f"<b>‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞:</b> <code>{str(e)}</code>"
            )
